(function(){function c(f,d,e){if(!d.is||!d.getCustomData("block_processed")){d.is&&CKEDITOR.dom.element.setMarker(e,d,"block_processed",true);f.push(d)}}function a(g){var d=[];var f=g.getChildren();for(var e=0;e<f.count();e++){var h=f.getItem(e);if(!(h.type===CKEDITOR.NODE_TEXT&&(/^[ \t\n\r]+$/).test(h.getText()))){d.push(h)}}return d}function b(j,h){var i=(function(){var p=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);delete p.div;if(j.config.div_wrapTable){delete p.td;delete p.th}return p})();var d=CKEDITOR.dtd.div;function k(r){var p=new CKEDITOR.dom.elementPath(r).elements;var s;for(var q=0;q<p.length;q++){if(p[q].getName() in i){s=p[q];break}}return s}function e(){this.foreach(function(p){if(/^(?!vbox|hbox)/.test(p.type)){if(!p.setup){p.setup=function(q){p.setValue(q.getAttribute(p.id)||"")}}if(!p.commit){p.commit=function(q){var r=this.getValue();if("dir"==p.id&&q.getComputedStyle("direction")==r){return}if(r){q.setAttribute(p.id,r)}else{q.removeAttribute(p.id)}}}}})}function l(s){var A=[];var y={};var D=[],v;var H=s.document.getSelection(),q=H.getRanges();var t=H.createBookmarks();var E,B;var F=s.config.enterMode==CKEDITOR.ENTER_DIV?"div":"p";for(E=0;E<q.length;E++){B=q[E].createIterator();while((v=B.getNextParagraph())){if(v.getName() in i){var C,p=v.getChildren();for(C=0;C<p.count();C++){c(D,p.getItem(C),y)}}else{while(!d[v.getName()]&&v.getName()!="body"){v=v.getParent()}c(D,v,y)}}}CKEDITOR.dom.element.clearAllMarkers(y);var u=n(D);var G,z,x;for(E=0;E<u.length;E++){var r=u[E][0];G=r.getParent();for(C=1;C<u[E].length;C++){G=G.getCommonAncestor(u[E][C])}x=new CKEDITOR.dom.element("div",s.document);for(C=0;C<u[E].length;C++){r=u[E][C];while(!r.getParent().equals(G)){r=r.getParent()}u[E][C]=r}var w=null;for(C=0;C<u[E].length;C++){r=u[E][C];if(!(r.getCustomData&&r.getCustomData("block_processed"))){r.is&&CKEDITOR.dom.element.setMarker(y,r,"block_processed",true);if(!C){x.insertBefore(r)}x.append(r)}}CKEDITOR.dom.element.clearAllMarkers(y);A.push(x)}H.selectBookmarks(t);return A}function m(q){var r=new CKEDITOR.dom.elementPath(q.getSelection().getStartElement()),p=r.blockLimit,s=p&&p.getAscendant("div",true);return s}function n(r){var p=[],v=null,t,u;for(var s=0;s<r.length;s++){u=r[s];var q=k(u);if(!q.equals(v)){v=q;p.push([])}p[p.length-1].push(u)}return p}function g(p){var s=this.getDialog(),r=s._element&&s._element.clone()||new CKEDITOR.dom.element("div",j.document);this.commit(r,true);p=[].concat(p);var t=p.length,u;for(var q=0;q<t;q++){u=s.getContentElement.apply(s,p[q].split(":"));u&&u.setup&&u.setup(r,true)}}var o={};var f=[];return{title:j.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:j.lang.common.generalTab,title:j.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:j.lang.div.styleSelectLabel,"default":"",items:[[j.lang.common.notSet,""]],onChange:function(){g.call(this,["info:class","advanced:dir","advanced:style"])},setup:function(q){for(var p in o){o[p].checkElementRemovable(q,true)&&this.setValue(p)}},commit:function(q){var p;if((p=this.getValue())){var r=o[p];var s=q.getCustomData("elementStyle")||"";r.applyToObject(q);q.setCustomData("elementStyle",s+r._.definition.attributes.style)}}},{id:"class",type:"text",label:j.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:j.lang.common.advancedTab,title:j.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",label:j.lang.common.id,"default":""},{type:"text",id:"lang",label:j.lang.link.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",style:"width: 100%;",label:j.lang.common.cssStyle,"default":"",commit:function(q){var p=this.getValue()+(q.getCustomData("elementStyle")||"");q.setAttribute("style",p)}}]},{type:"hbox",children:[{type:"text",id:"title",style:"width: 100%;",label:j.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",style:"width: 100%;",label:j.lang.common.langDir,"default":"",items:[[j.lang.common.notSet,""],[j.lang.common.langDirLtr,"ltr"],[j.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){e.call(this);var q=this,p=this.getContentElement("info","elementStyle");j.getStylesSet(function(u){var s;if(u){for(var r=0;r<u.length;r++){var t=u[r];if(t.element&&t.element=="div"){s=t.name;o[s]=new CKEDITOR.style(t);p.items.push([s,s]);p.add(s,s)}}}p[p.items.length>1?"enable":"disable"]();setTimeout(function(){p.setup(q._element)},0)})},onShow:function(){if(h=="editdiv"){var p=m(j);p&&this.setupContent(this._element=p)}},onOk:function(){if(h=="editdiv"){f=[this._element]}else{f=l(j,true)}var q=f.length;for(var p=0;p<q;p++){this.commitContent(f[p]);!f[p].getAttribute("style")&&f[p].removeAttribute("style")}this.hide()},onHide:function(){if(h=="editdiv"){this._element.removeCustomData("elementStyle")}delete this._element}}}CKEDITOR.dialog.add("creatediv",function(d){return b(d,"creatediv")});CKEDITOR.dialog.add("editdiv",function(d){return b(d,"editdiv")})})();