(function(){CKEDITOR.on("dialogDefinition",function(u){var t,i=u.data.name,s=u.data.definition;if(i=="link"){s.removeContents("target");s.removeContents("upload");s.removeContents("advanced");t=s.getContents("info");t.remove("emailSubject");t.remove("emailBody")}else{if(i=="image"){s.removeContents("advanced");t=s.getContents("Link");t.remove("cmbTarget");t=s.getContents("info");t.remove("txtAlt");t.remove("basic")}}});var l={b:"strong",u:"u",i:"em",color:"span",size:"span",quote:"blockquote",code:"code",url:"a",email:"span",img:"span","*":"li",list:"ol"},m={strong:"b",b:"b",u:"u",em:"i",i:"i",code:"code",li:"*"},r={strong:"b",em:"i",u:"u",li:"*",ul:"list",ol:"list",code:"code",a:"link",img:"img",blockquote:"quote"},q={color:"color",size:"font-size"},g={url:"href",email:"mailhref",quote:"cite",list:"listType"};var b=CKEDITOR.dtd,k=CKEDITOR.tools.extend({table:1},b.$block,b.$listItem,b.$tableContent,b.$list);var f=/\s*(?:;\s*|$)/;function d(s){var v="";for(var i in s){var u=s[i],t=(i+":"+u).replace(f,";");v+=t}return v}function e(s){var i={};(s||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(u,t,v){i[t.toLowerCase()]=v});return i}function p(i){return i.replace(/(?:rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\))/gi,function(u,x,w,s){x=parseInt(x,10).toString(16);w=parseInt(w,10).toString(16);s=parseInt(s,10).toString(16);var t=[x,w,s];for(var v=0;v<t.length;v++){t[v]=String("0"+t[v]).slice(-2)}return"#"+t.join("")})}var a={smiley:":)",sad:":(",wink:";)",laugh:":D",cheeky:":P",blush:":*)",surprise:":-o",indecision:":|",angry:">:(",angel:"o:)",cool:"8-)",devil:">:-)",crying:";(",kiss:":-*"},n={},j=[];for(var h in a){n[a[h]]=h;j.push(a[h].replace(/\(|\)|\:|\/|\*|\-|\|/g,function(i){return"\\"+i}))}j=new RegExp(j.join("|"),"g");var o=(function(){var s=[],t={nbsp:"\u00A0",shy:"\u00AD",gt:"\u003E",lt:"\u003C"};for(var i in t){s.push(i)}s=new RegExp("&("+s.join("|")+");","g");return function(u){return u.replace(s,function(w,v){return t[v]})}})();CKEDITOR.BBCodeParser=function(){this._={bbcPartsRegex:/(?:\[([^\/\]=]*?)(?:=([^\]]*?))?\])|(?:\[\/([a-z]{1,16})\])/ig}};CKEDITOR.BBCodeParser.prototype={parse:function(y){var v,t,w=0;while((v=this._.bbcPartsRegex.exec(y))){var x=v.index;if(x>w){var z=y.substring(w,x);this.onText(z,1)}w=this._.bbcPartsRegex.lastIndex;t=(v[1]||v[3]||"").toLowerCase();if(t&&!l[t]){this.onText(v[0]);continue}if(v[1]){var u=l[t],i={},A={},s=v[2];if(s){if(t=="list"){if(!isNaN(s)){s="decimal"}else{if(/^[a-z]+$/.test(s)){s="lower-alpha"}else{if(/^[A-Z]+$/.test(s)){s="upper-alpha"}}}}if(q[t]){if(t=="size"){s+="%"}A[q[t]]=s;i.style=d(A)}else{if(g[t]){i[g[t]]=s}}}if(t=="email"||t=="img"){i.bbcode=t}this.onTagOpen(u,i,CKEDITOR.dtd.$empty[u])}else{if(v[3]){this.onTagClose(l[t])}}}if(y.length>w){this.onText(y.substring(w,y.length),1)}}};CKEDITOR.htmlParser.fragment.fromBBCode=function(i){var s=new CKEDITOR.BBCodeParser(),A=new CKEDITOR.htmlParser.fragment(),B=[],z=0,u=A,t;function y(I){if(B.length>0){for(var F=0;F<B.length;F++){var E=B[F],G=E.name,H=CKEDITOR.dtd[G],D=u.name&&CKEDITOR.dtd[u.name];if((!D||D[G])&&(!I||!H||H[I]||!CKEDITOR.dtd[I])){E=E.clone();E.parent=u;u=E;B.splice(F,1);F--}}}}function x(G,F){var D=u.children.length,H=D>0&&u.children[D-1],J=!H&&c.getRule(r[u.name],"breakAfterOpen"),E=H&&H.type==CKEDITOR.NODE_ELEMENT&&c.getRule(r[H.name],"breakAfterClose"),I=G&&c.getRule(r[G],F?"breakBeforeClose":"breakBeforeOpen");if(z&&(J||E||I)){z--}if(z&&G in k){z++}while(z&&z--){u.children.push(H=new CKEDITOR.htmlParser.element("br"))}}function w(F,G){x(F.name,1);G=G||u||A;var D=G.children.length,E=D>0&&G.children[D-1]||null;F.previous=E;F.parent=G;G.children.push(F);if(F.returnPoint){u=F.returnPoint;delete F.returnPoint}}s.onTagOpen=function(K,I,H){var J=new CKEDITOR.htmlParser.element(K,I);if(CKEDITOR.dtd.$removeEmpty[K]){B.push(J);return}var G=u.name;var F=G&&(CKEDITOR.dtd[G]||(u._.isBlockLike?CKEDITOR.dtd.div:CKEDITOR.dtd.span));if(F&&!F[K]){var E=false,D;if(K==G){w(u,u.parent)}else{if(K in CKEDITOR.dtd.$listItem){s.onTagOpen("ul",{});D=u;E=true}else{w(u,u.parent);B.unshift(u);E=true}}if(D){u=D}else{u=u.returnPoint||u.parent}if(E){s.onTagOpen.apply(this,arguments);return}}y(K);x(K);J.parent=u;J.returnPoint=t;t=0;if(J.isEmpty){w(J)}else{u=J}};s.onTagClose=function(F){for(var E=B.length-1;E>=0;E--){if(F==B[E].name){B.splice(E,1);return}}var I=[],D=[],G=u;while(G.type&&G.name!=F){if(!G._.isBlockLike){D.unshift(G)}I.push(G);G=G.parent}if(G.type){for(E=0;E<I.length;E++){var H=I[E];w(H,H.parent)}u=G;w(G,G.parent);if(G==u){u=u.parent}B=B.concat(D)}};s.onText=function(E){var D=CKEDITOR.dtd[u.name];if(!D||D["#"]){x();y();E.replace(/([\r\n])|[^\r\n]*/g,function(G,F){if(F!==undefined&&F.length){z++}else{if(G.length){var H=0;G.replace(j,function(J,I){w(new CKEDITOR.htmlParser.text(G.substring(H,I)),u);w(new CKEDITOR.htmlParser.element("smiley",{desc:n[J]}),u);H=I+J.length});if(H!=G.length){w(new CKEDITOR.htmlParser.text(G.substring(H,G.length)),u)}}}})}};s.parse(CKEDITOR.tools.htmlEncode(i));while(u.type){var C=u.parent,v=u;w(v,C);u=C}return A};CKEDITOR.htmlParser.BBCodeWriter=CKEDITOR.tools.createClass({$:function(){this._={output:[],rules:[]};this.setRules("list",{breakBeforeOpen:1,breakAfterOpen:1,breakBeforeClose:1,breakAfterClose:1});this.setRules("*",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:1,breakAfterClose:0});this.setRules("quote",{breakBeforeOpen:1,breakAfterOpen:0,breakBeforeClose:0,breakAfterClose:1})},proto:{setRules:function(i,t){var s=this._.rules[i];if(s){CKEDITOR.tools.extend(s,t,true)}else{this._.rules[i]=t}},getRule:function(i,s){return this._.rules[i]&&this._.rules[i][s]},openTag:function(i,s){if(i in l){if(this.getRule(i,"breakBeforeOpen")){this.lineBreak(1)}this.write("[",i);var t=s.option;t&&this.write("=",t);this.write("]");if(this.getRule(i,"breakAfterOpen")){this.lineBreak(1)}}else{if(i=="br"){this._.output.push("\n")}}},openTagClose:function(){},attribute:function(){},closeTag:function(i){if(i in l){if(this.getRule(i,"breakBeforeClose")){this.lineBreak(1)}i!="*"&&this.write("[/",i,"]");if(this.getRule(i,"breakAfterClose")){this.lineBreak(1)}}},text:function(i){this.write(i)},comment:function(){},lineBreak:function(){if(!this._.hasLineBreak&&this._.output.length){this.write("\n");this._.hasLineBreak=1}},write:function(){this._.hasLineBreak=0;var i=Array.prototype.join.call(arguments,"");this._.output.push(i)},reset:function(){this._.output=[];this._.hasLineBreak=0},getHtml:function(s){var i=this._.output.join("");if(s){this.reset()}return o(i)}}});var c=new CKEDITOR.htmlParser.BBCodeWriter();CKEDITOR.plugins.add("bbcode",{requires:["htmldataprocessor","entities"],beforeInit:function(s){var i=s.config;CKEDITOR.tools.extend(i,{enterMode:CKEDITOR.ENTER_BR,basicEntities:false,entities:false,fillEmptyBlocks:false},true)},init:function(t){var i=t.config;function s(w){var v=CKEDITOR.htmlParser.fragment.fromBBCode(w),x=new CKEDITOR.htmlParser.basicWriter();v.writeHtml(x,u);return x.getHtml(true)}var u=new CKEDITOR.htmlParser.filter();u.addRules({elements:{blockquote:function(v){var w=new CKEDITOR.htmlParser.element("div");w.children=v.children;v.children=[w];var y=v.attributes.cite;if(y){var x=new CKEDITOR.htmlParser.element("cite");x.add(new CKEDITOR.htmlParser.text(y.replace(/^"|"$/g,"")));delete v.attributes.cite;v.children.unshift(x)}},span:function(w){var v;if((v=w.attributes.bbcode)){if(v=="img"){w.name="img";w.attributes.src=w.children[0].value;w.children=[]}else{if(v=="email"){w.name="a";w.attributes.href="mailto:"+w.children[0].value}}delete w.attributes.bbcode}},ol:function(v){if(v.attributes.listType){if(v.attributes.listType!="decimal"){v.attributes.style="list-style-type:"+v.attributes.listType}}else{v.name="ul"}delete v.attributes.listType},a:function(v){if(!v.attributes.href){v.attributes.href=v.children[0].value}},smiley:function(v){v.name="img";var w=v.attributes.desc,x=i.smiley_images[CKEDITOR.tools.indexOf(i.smiley_descriptions,w)],y=CKEDITOR.tools.htmlEncode(i.smiley_path+x);v.attributes={src:y,"data-cke-saved-src":y,title:w,alt:w}}}});t.dataProcessor.htmlFilter.addRules({elements:{$:function(E){var D=E.attributes,w=e(D.style),F;var y=E.name;if(y in m){y=m[y]}else{if(y=="span"){if((F=w.color)){y="color";F=p(F)}else{if((F=w["font-size"])){var x=F.match(/(\d+)%$/);if(x){F=x[1];y="size"}}}}else{if(y=="ol"||y=="ul"){if((F=w["list-style-type"])){switch(F){case"lower-alpha":F="a";break;case"upper-alpha":F="A";break}}else{if(y=="ol"){F=1}}y="list"}else{if(y=="blockquote"){try{var z=E.children[0],A=E.children[1],C=z.name=="cite"&&z.children[0].value;if(C){F='"'+C+'"';E.children=A.children}}catch(G){}y="quote"}else{if(y=="a"){if((F=D.href)){if(F.indexOf("mailto:")!==-1){y="email";E.children=[new CKEDITOR.htmlParser.text(F.replace("mailto:",""))];F=""}else{var B=E.children.length==1&&E.children[0];if(B&&B.type==CKEDITOR.NODE_TEXT&&B.value==F){F=""}y="url"}}}else{if(y=="img"){E.isEmpty=0;var v=D["data-cke-saved-src"];if(v&&v.indexOf(t.config.smiley_path)!=-1){return new CKEDITOR.htmlParser.text(a[D.alt])}else{E.children=[new CKEDITOR.htmlParser.text(v)]}}}}}}}E.name=y;F&&(E.attributes.option=F);return null},br:function(v){var w=v.next;if(w&&w.name in k){return false}}}},1);t.dataProcessor.writer=c;t.on("beforeSetMode",function(w){w.removeListener();var v=t._.modes.wysiwyg;v.loadData=CKEDITOR.tools.override(v.loadData,function(x){return function(y){return(x.call(this,s(y)))}})})},afterInit:function(i){var s;if(i._.elementsPath){if((s=i._.elementsPath.filters)){s.push(function(v){var u=v.getName(),t=r[u]||false;if(t=="link"&&v.getAttribute("href").indexOf("mailto:")===0){t="email"}else{if(u=="span"){if(v.getStyle("font-size")){t="size"}else{if(v.getStyle("color")){t="color"}}}else{if(t=="img"){var w=v.data("cke-saved-src");if(w&&w.indexOf(i.config.smiley_path)===0){t="smiley"}}}}return t})}}}})})();