(function(){function c(r,l){var m=this.range;if(this._.end){return null}if(!this._.start){this._.start=1;if(m.collapsed){this.end();return null}m.optimize()}var i,t=m.startContainer,x=m.endContainer,o=m.startOffset,q=m.endOffset,n,h=this.guard,p=this.type,v=(r?"getPreviousSourceNode":"getNextSourceNode");if(!r&&!this._.guardLTR){var k=x.type==CKEDITOR.NODE_ELEMENT?x:x.getParent();var s=x.type==CKEDITOR.NODE_ELEMENT?x.getChild(q):x.getNext();this._.guardLTR=function(z,y){return((!y||!k.equals(z))&&(!s||!z.equals(s))&&(z.type!=CKEDITOR.NODE_ELEMENT||!y||z.getName()!="body"))}}if(r&&!this._.guardRTL){var w=t.type==CKEDITOR.NODE_ELEMENT?t:t.getParent();var j=t.type==CKEDITOR.NODE_ELEMENT?o?t.getChild(o-1):null:t.getPrevious();this._.guardRTL=function(z,y){return((!y||!w.equals(z))&&(!j||!z.equals(j))&&(z.type!=CKEDITOR.NODE_ELEMENT||!y||z.getName()!="body"))}}var u=r?this._.guardRTL:this._.guardLTR;if(h){n=function(z,y){if(u(z,y)===false){return false}return h(z,y)}}else{n=u}if(this.current){i=this.current[v](false,p,n)}else{if(r){i=x;if(i.type==CKEDITOR.NODE_ELEMENT){if(q>0){i=i.getChild(q-1)}else{i=(n(i,true)===false)?null:i.getPreviousSourceNode(true,p,n)}}}else{i=t;if(i.type==CKEDITOR.NODE_ELEMENT){if(!(i=i.getChild(o))){i=(n(t,true)===false)?null:t.getNextSourceNode(true,p,n)}}}if(i&&n(i)===false){i=null}}while(i&&!this._.end){this.current=i;if(!this.evaluator||this.evaluator(i)!==false){if(!l){return i}}else{if(l&&this.evaluator){return false}}i=i[v](false,p,n)}this.end();return this.current=null}function b(j){var i,h=null;while((i=c.call(this,j))){h=i}return h}CKEDITOR.dom.walker=CKEDITOR.tools.createClass({$:function(h){this.range=h;this._={}},proto:{end:function(){this._.end=1},next:function(){return c.call(this)},previous:function(){return c.call(this,1)},checkForward:function(){return c.call(this,0,1)!==false},checkBackward:function(){return c.call(this,1,1)!==false},lastForward:function(){return b.call(this)},lastBackward:function(){return b.call(this,1)},reset:function(){delete this.current;this._={}}}});var e={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1};CKEDITOR.dom.element.prototype.isBlockBoundary=function(i){var h=i?CKEDITOR.tools.extend({},CKEDITOR.dtd.$block,i||{}):CKEDITOR.dtd.$block;return this.getComputedStyle("float")=="none"&&e[this.getComputedStyle("display")]||h[this.getName()]};CKEDITOR.dom.walker.blockBoundary=function(h){return function(j,i){return !(j.type==CKEDITOR.NODE_ELEMENT&&j.isBlockBoundary(h))}};CKEDITOR.dom.walker.listItemBoundary=function(){return this.blockBoundary({br:1})};CKEDITOR.dom.walker.bookmark=function(j,i){function h(k){return(k&&k.getName&&k.getName()=="span"&&k.data("cke-bookmark"))}return function(m){var k,l;k=(m&&!m.getName&&(l=m.getParent())&&h(l));k=j?k:k||h(m);return !!(i^k)}};CKEDITOR.dom.walker.whitespaces=function(h){return function(j){var i=j&&(j.type==CKEDITOR.NODE_TEXT)&&!CKEDITOR.tools.trim(j.getText());return !!(h^i)}};CKEDITOR.dom.walker.invisible=function(i){var h=CKEDITOR.dom.walker.whitespaces();return function(j){var k=h(j)||j.is&&!j.$.offsetHeight;return !!(i^k)}};CKEDITOR.dom.walker.nodeType=function(i,h){return function(j){return !!(h^(j.type==i))}};CKEDITOR.dom.walker.bogus=function(i){function h(j){return !a(j)&&!d(j)}return function(l){var m=!CKEDITOR.env.ie?l.is&&l.is("br"):l.getText&&g.test(l.getText());if(m){var k=l.getParent(),j=l.getNext(h);m=k.isBlockBoundary()&&(!j||j.type==CKEDITOR.NODE_ELEMENT&&j.isBlockBoundary())}return !!(i^m)}};var g=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,a=CKEDITOR.dom.walker.whitespaces(),d=CKEDITOR.dom.walker.bookmark(),f=function(h){return d(h)||a(h)||h.type==CKEDITOR.NODE_ELEMENT&&h.getName() in CKEDITOR.dtd.$inline&&!(h.getName() in CKEDITOR.dtd.$empty)};CKEDITOR.dom.element.prototype.getBogus=function(){var h=this;do{h=h.getPreviousSourceNode()}while(f(h));if(h&&(!CKEDITOR.env.ie?h.is&&h.is("br"):h.getText&&g.test(h.getText()))){return h}return false}})();