(function(){var e=CKEDITOR.tools.cssLength;var b=function(f){var g=this.id;if(!f.info){f.info={}}f.info[g]=this.getValue()};function a(n){var k=0,h=0;for(var g=0,o,p=n.$.rows.length;g<p;g++){o=n.$.rows[g],k=0;for(var f=0,l,m=o.cells.length;f<m;f++){l=o.cells[f];k+=l.colSpan}k>h&&(h=k)}return h}function d(f){return function(){var h=this.getValue(),g=!!(CKEDITOR.dialog.validate.integer()(h)&&h>0);if(!g){alert(f);this.select()}return g}}function c(g,i){var f=function(j){return new CKEDITOR.dom.element(j,g.document)};var h=g.plugins.dialogadvtab;return{title:g.lang.table.title,minWidth:310,minHeight:CKEDITOR.env.ie?310:280,onLoad:function(){var j=this;var k=j.getContentElement("advanced","advStyles");if(k){k.on("change",function(m){var o=this.getStyle("width",""),p=j.getContentElement("info","txtWidth");p&&p.setValue(o,true);var l=this.getStyle("height",""),n=j.getContentElement("info","txtHeight");n&&n.setValue(l,true)})}},onShow:function(){var p=g.getSelection(),l=p.getRanges(),o=null;var k=this.getContentElement("info","txtRows"),n=this.getContentElement("info","txtCols"),m=this.getContentElement("info","txtWidth"),j=this.getContentElement("info","txtHeight");if(i=="tableProperties"){if((o=p.getSelectedElement())){o=o.getAscendant("table",true)}else{if(l.length>0){if(CKEDITOR.env.webkit){l[0].shrink(CKEDITOR.NODE_ELEMENT)}var q=l[0].getCommonAncestor(true);o=q.getAscendant("table",true)}}this._.selectedElement=o}if(o){this.setupContent(o);k&&k.disable();n&&n.disable()}else{k&&k.enable();n&&n.enable()}m&&m.onChange();j&&j.onChange()},onOk:function(){var D=g.getSelection(),z=this._.selectedElement&&D.createBookmarks();var x=this._.selectedElement||f("table"),B=this,C={};this.commitContent(C,x);if(C.info){var y=C.info;if(!this._.selectedElement){var k=x.append(f("tbody")),r=parseInt(y.txtRows,10)||0,s=parseInt(y.txtCols,10)||0;for(var v=0;v<r;v++){var q=k.append(f("tr"));for(var u=0;u<s;u++){var m=q.append(f("td"));if(!CKEDITOR.env.ie){m.append(f("br"))}}}}var o=y.selHeaders;if(!x.$.tHead&&(o=="row"||o=="both")){var w=new CKEDITOR.dom.element(x.$.createTHead());k=x.getElementsByTag("tbody").getItem(0);var n=k.getElementsByTag("tr").getItem(0);for(v=0;v<n.getChildCount();v++){var p=n.getChild(v);if(p.type==CKEDITOR.NODE_ELEMENT&&!p.data("cke-bookmark")){p.renameNode("th");p.setAttribute("scope","col")}}w.append(n.remove())}if(x.$.tHead!==null&&!(o=="row"||o=="both")){w=new CKEDITOR.dom.element(x.$.tHead);k=x.getElementsByTag("tbody").getItem(0);var l=k.getFirst();while(w.getChildCount()>0){n=w.getFirst();for(v=0;v<n.getChildCount();v++){var t=n.getChild(v);if(t.type==CKEDITOR.NODE_ELEMENT){t.renameNode("td");t.removeAttribute("scope")}}n.insertBefore(l)}w.remove()}if(!this.hasColumnHeaders&&(o=="col"||o=="both")){for(q=0;q<x.$.rows.length;q++){t=new CKEDITOR.dom.element(x.$.rows[q].cells[0]);t.renameNode("th");t.setAttribute("scope","row")}}if((this.hasColumnHeaders)&&!(o=="col"||o=="both")){for(v=0;v<x.$.rows.length;v++){q=new CKEDITOR.dom.element(x.$.rows[v]);if(q.getParent().getName()=="tbody"){t=new CKEDITOR.dom.element(q.$.cells[0]);t.renameNode("td");t.removeAttribute("scope")}}}y.txtHeight?x.setStyle("height",y.txtHeight):x.removeStyle("height");y.txtWidth?x.setStyle("width",y.txtWidth):x.removeStyle("width");if(!x.getAttribute("style")){x.removeAttribute("style")}}if(!this._.selectedElement){g.insertElement(x);setTimeout(function(){var E=new CKEDITOR.dom.element(x.$.rows[0].cells[0]);var j=new CKEDITOR.dom.range(g.document);j.moveToPosition(E,CKEDITOR.POSITION_AFTER_START);j.select(1)},0)}else{try{D.selectBookmarks(z)}catch(A){}}},contents:[{id:"info",label:g.lang.table.title,elements:[{type:"hbox",widths:[null,null],styles:["vertical-align:top"],children:[{type:"vbox",padding:0,children:[{type:"text",id:"txtRows","default":3,label:g.lang.table.rows,required:true,controlStyle:"width:5em",validate:d(g.lang.table.invalidRows),setup:function(j){this.setValue(j.$.rows.length)},commit:b},{type:"text",id:"txtCols","default":2,label:g.lang.table.columns,required:true,controlStyle:"width:5em",validate:d(g.lang.table.invalidCols),setup:function(j){this.setValue(a(j))},commit:b},{type:"html",html:"&nbsp;"},{type:"select",id:"selHeaders","default":"",label:g.lang.table.headers,items:[[g.lang.table.headersNone,""],[g.lang.table.headersRow,"row"],[g.lang.table.headersColumn,"col"],[g.lang.table.headersBoth,"both"]],setup:function(k){var l=this.getDialog();l.hasColumnHeaders=true;for(var m=0;m<k.$.rows.length;m++){var j=k.$.rows[m].cells[0];if(j&&j.nodeName.toLowerCase()!="th"){l.hasColumnHeaders=false;break}}if((k.$.tHead!==null)){this.setValue(l.hasColumnHeaders?"both":"row")}else{this.setValue(l.hasColumnHeaders?"col":"")}},commit:b},{type:"text",id:"txtBorder","default":1,label:g.lang.table.border,controlStyle:"width:3em",validate:CKEDITOR.dialog.validate.number(g.lang.table.invalidBorder),setup:function(j){this.setValue(j.getAttribute("border")||"")},commit:function(k,j){if(this.getValue()){j.setAttribute("border",this.getValue())}else{j.removeAttribute("border")}}},{id:"cmbAlign",type:"select","default":"",label:g.lang.common.align,items:[[g.lang.common.notSet,""],[g.lang.common.alignLeft,"left"],[g.lang.common.alignCenter,"center"],[g.lang.common.alignRight,"right"]],setup:function(j){this.setValue(j.getAttribute("align")||"")},commit:function(k,j){if(this.getValue()){j.setAttribute("align",this.getValue())}else{j.removeAttribute("align")}}}]},{type:"vbox",padding:0,children:[{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtWidth",controlStyle:"width:5em",label:g.lang.common.width,title:g.lang.common.cssLengthTooltip,"default":500,getValue:e,validate:CKEDITOR.dialog.validate.cssLength(g.lang.common.invalidCssLength.replace("%1",g.lang.common.width)),onChange:function(){var j=this.getDialog().getContentElement("advanced","advStyles");j&&j.updateStyle("width",this.getValue())},setup:function(j){var k=j.getStyle("width");k&&this.setValue(k)},commit:b}]},{type:"hbox",widths:["5em"],children:[{type:"text",id:"txtHeight",controlStyle:"width:5em",label:g.lang.common.height,title:g.lang.common.cssLengthTooltip,"default":"",getValue:e,validate:CKEDITOR.dialog.validate.cssLength(g.lang.common.invalidCssLength.replace("%1",g.lang.common.height)),onChange:function(){var j=this.getDialog().getContentElement("advanced","advStyles");j&&j.updateStyle("height",this.getValue())},setup:function(j){var k=j.getStyle("height");k&&this.setValue(k)},commit:b}]},{type:"html",html:"&nbsp;"},{type:"text",id:"txtCellSpace",controlStyle:"width:3em",label:g.lang.table.cellSpace,"default":1,validate:CKEDITOR.dialog.validate.number(g.lang.table.invalidCellSpacing),setup:function(j){this.setValue(j.getAttribute("cellSpacing")||"")},commit:function(k,j){if(this.getValue()){j.setAttribute("cellSpacing",this.getValue())}else{j.removeAttribute("cellSpacing")}}},{type:"text",id:"txtCellPad",controlStyle:"width:3em",label:g.lang.table.cellPad,"default":1,validate:CKEDITOR.dialog.validate.number(g.lang.table.invalidCellPadding),setup:function(j){this.setValue(j.getAttribute("cellPadding")||"")},commit:function(k,j){if(this.getValue()){j.setAttribute("cellPadding",this.getValue())}else{j.removeAttribute("cellPadding")}}}]}]},{type:"html",align:"right",html:""},{type:"vbox",padding:0,children:[{type:"text",id:"txtCaption",label:g.lang.table.caption,setup:function(l){this.enable();var k=l.getElementsByTag("caption");if(k.count()>0){var j=k.getItem(0);var m=j.getFirst(CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT));if(m&&!m.equals(j.getBogus())){this.disable();this.setValue(j.getText());return}j=CKEDITOR.tools.trim(j.getText());this.setValue(j)}},commit:function(n,m){if(!this.isEnabled()){return}var j=this.getValue(),l=m.getElementsByTag("caption");if(j){if(l.count()>0){l=l.getItem(0);l.setHtml("")}else{l=new CKEDITOR.dom.element("caption",g.document);if(m.getChildCount()){l.insertBefore(m.getFirst())}else{l.appendTo(m)}}l.append(new CKEDITOR.dom.text(j,g.document))}else{if(l.count()>0){for(var k=l.count()-1;k>=0;k--){l.getItem(k).remove()}}}}},{type:"text",id:"txtSummary",label:g.lang.table.summary,setup:function(j){this.setValue(j.getAttribute("summary")||"")},commit:function(k,j){if(this.getValue()){j.setAttribute("summary",this.getValue())}else{j.removeAttribute("summary")}}}]}]},h&&h.createAdvancedTab(g)]}}CKEDITOR.dialog.add("table",function(f){return c(f,"table")});CKEDITOR.dialog.add("tableProperties",function(f){return c(f,"tableProperties")})})();