(function(){var x={ol:1,ul:1},d=/^[\n\r\t ]*$/;var p=CKEDITOR.dom.walker.whitespaces(),e=CKEDITOR.dom.walker.bookmark(),g=function(i){return !(p(i)||e(i))},w=CKEDITOR.dom.walker.bogus();function c(D){var C,E,i;if((C=D.getDirection())){E=D.getParent();while(E&&!(i=E.getDirection())){E=E.getParent()}if(C==i){D.removeAttribute("dir")}}}function h(D,C){var i=D.getAttribute("style");i&&C.setAttribute("style",i.replace(/([^;])$/,"$1;")+(C.getAttribute("style")||""))}CKEDITOR.plugins.list={listToArray:function(F,N,L,K,M){if(!x[F.getName()]){return[]}if(!K){K=0}if(!L){L=[]}for(var H=0,I=F.getChildCount();H<I;H++){var C=F.getChild(H);if(C.type==CKEDITOR.NODE_ELEMENT&&C.getName() in CKEDITOR.dtd.$list){CKEDITOR.plugins.list.listToArray(C,N,L,K+1)}if(C.$.nodeName.toLowerCase()!="li"){continue}var J={parent:F,indent:K,element:C,contents:[]};if(!M){J.grandparent=F.getParent();if(J.grandparent&&J.grandparent.$.nodeName.toLowerCase()=="li"){J.grandparent=J.grandparent.getParent()}}else{J.grandparent=M}if(N){CKEDITOR.dom.element.setMarker(N,C,"listarray_index",L.length)}L.push(J);for(var G=0,D=C.getChildCount(),E;G<D;G++){E=C.getChild(G);if(E.type==CKEDITOR.NODE_ELEMENT&&x[E.getName()]){CKEDITOR.plugins.list.listToArray(E,N,L,K+1,J.grandparent)}else{J.contents.push(E)}}}return L},arrayToList:function(K,T,U,af,X){if(!U){U=0}if(!K||K.length<U+1){return null}var aa,ae=K[U].parent.getDocument(),W=new CKEDITOR.dom.documentFragment(ae),ad=null,D=U,Y=Math.max(K[U].indent,0),C=null,H,O,R=(af==CKEDITOR.ENTER_P?"p":"div");while(1){var ac=K[D],E=ac.grandparent;H=ac.element.getDirection(1);if(ac.indent==Y){if(!ad||K[D].parent.getName()!=ad.getName()){ad=K[D].parent.clone(false,1);X&&ad.setAttribute("dir",X);W.append(ad)}C=ad.append(ac.element.clone(0,1));if(H!=ad.getDirection(1)){C.setAttribute("dir",H)}for(aa=0;aa<ac.contents.length;aa++){C.append(ac.contents[aa].clone(1,1))}D++}else{if(ac.indent==Math.max(Y,0)+1){var Z=K[D-1].element.getDirection(1),V=CKEDITOR.plugins.list.arrayToList(K,null,D,af,Z!=H?H:null);if(!C.getChildCount()&&CKEDITOR.env.ie&&!(ae.$.documentMode>7)){C.append(ae.createText("\xa0"))}C.append(V.listNode);D=V.nextIndex}else{if(ac.indent==-1&&!U&&E){if(x[E.getName()]){C=ac.element.clone(false,true);if(H!=E.getDirection(1)){C.setAttribute("dir",H)}}else{C=new CKEDITOR.dom.documentFragment(ae)}var Q=E.getDirection(1)!=H,S=ac.element,F=S.getAttribute("class"),ab=S.getAttribute("style");var M=C.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&(af!=CKEDITOR.ENTER_BR||Q||ab||F);var J,L=ac.contents.length;for(aa=0;aa<L;aa++){J=ac.contents[aa];if(J.type==CKEDITOR.NODE_ELEMENT&&J.isBlockBoundary()){if(Q&&!J.getDirection()){J.setAttribute("dir",H)}h(S,J);F&&J.addClass(F)}else{if(M){if(!O){O=ae.createElement(R);Q&&O.setAttribute("dir",H)}ab&&O.setAttribute("style",ab);F&&O.setAttribute("class",F);O.append(J.clone(1,1))}}C.append(O||J.clone(1,1))}if(C.type==CKEDITOR.NODE_DOCUMENT_FRAGMENT&&D!=K.length-1){var P=C.getLast();if(P&&P.type==CKEDITOR.NODE_ELEMENT&&P.getAttribute("type")=="_moz"){P.remove()}if(!(P=C.getLast(g)&&P.type==CKEDITOR.NODE_ELEMENT&&P.getName() in CKEDITOR.dtd.$block)){C.append(ae.createElement("br"))}}var N=C.$.nodeName.toLowerCase();if(!CKEDITOR.env.ie&&(N=="div"||N=="p")){C.appendBogus()}W.append(C);ad=null;D++}else{return null}}}O=null;if(K.length<=D||Math.max(K[D].indent,0)<Y){break}}if(T){var G=W.getFirst(),I=K[0].parent;while(G){if(G.type==CKEDITOR.NODE_ELEMENT){CKEDITOR.dom.element.clearMarkers(T,G);if(G.getName() in CKEDITOR.dtd.$listItem){c(G)}}G=G.getNextSourceNode()}}return{listNode:W,nextIndex:D}}};function l(C){if(C.editor.readOnly){return null}var H=C.data.path,D=H.blockLimit,G=H.elements,F,E;for(E=0;E<G.length&&(F=G[E])&&!F.equals(D);E++){if(x[G[E].getName()]){return this.setState(this.type==G[E].getName()?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}}return this.setState(CKEDITOR.TRISTATE_OFF)}function j(M,L,Q,R){var H=CKEDITOR.plugins.list.listToArray(L.root,Q),O=[];for(var K=0;K<L.contents.length;K++){var F=L.contents[K];F=F.getAscendant("li",true);if(!F||F.getCustomData("list_item_processed")){continue}O.push(F);CKEDITOR.dom.element.setMarker(Q,F,"list_item_processed",true)}var N=L.root,P=N.getDocument(),I,J;for(K=0;K<O.length;K++){var G=O[K].getCustomData("listarray_index");I=H[G].parent;if(!I.is(this.type)){J=P.createElement(this.type);I.copyAttributes(J,{start:1,type:1});J.removeStyle("list-style-type");H[G].parent=J}}var E=CKEDITOR.plugins.list.arrayToList(H,Q,null,M.config.enterMode);var D,C=E.listNode.getChildCount();for(K=0;K<C&&(D=E.listNode.getChild(K));K++){if(D.getName()==this.type){R.push(D)}}E.listNode.replace(L.root)}var A=/^h[1-6]$/;function b(D,I,H){var Q=I.contents,U=I.root.getDocument(),S=[];if(Q.length==1&&Q[0].equals(I.root)){var P=U.createElement("div");Q[0].moveChildren&&Q[0].moveChildren(P);Q[0].append(P);Q[0]=P}var M=I.contents[0].getParent();for(var O=0;O<Q.length;O++){M=M.getCommonAncestor(Q[O].getParent())}var R=D.config.useComputedState,N,C;R=R===undefined||R;for(O=0;O<Q.length;O++){var F=Q[O],J;while((J=F.getParent())){if(J.equals(M)){S.push(F);if(!C&&F.getDirection()){C=1}var L=F.getDirection(R);if(N!==null){if(N&&N!=L){N=null}else{N=L}}break}F=J}}if(S.length<1){return}var T=S[S.length-1].getNext(),E=U.createElement(this.type);H.push(E);var G,K;while(S.length){G=S.shift();K=U.createElement("li");if(G.is("pre")||A.test(G.getName())){G.appendTo(K)}else{G.copyAttributes(K);if(N&&G.getDirection()){K.removeStyle("direction");K.removeAttribute("dir")}G.moveChildren(K);G.remove()}K.appendTo(E)}if(N&&C){E.setAttribute("dir",N)}if(T){E.insertBefore(T)}else{E.appendTo(M)}}function z(L,K,R){var H=CKEDITOR.plugins.list.listToArray(K.root,R),P=[];for(var I=0;I<K.contents.length;I++){var E=K.contents[I];E=E.getAscendant("li",true);if(!E||E.getCustomData("list_item_processed")){continue}P.push(E);CKEDITOR.dom.element.setMarker(R,E,"list_item_processed",true)}var M=null;for(I=0;I<P.length;I++){var G=P[I].getCustomData("listarray_index");H[G].indent=-1;M=G}for(I=M+1;I<H.length;I++){if(H[I].indent>H[I-1].indent+1){var O=H[I-1].indent+1-H[I].indent;var F=H[I].indent;while(H[I]&&H[I].indent>=F){H[I].indent+=O;I++}I--}}var D=CKEDITOR.plugins.list.arrayToList(H,R,null,L.config.enterMode,K.root.getAttribute("dir"));var N=D.listNode,C,J;function Q(i){if((C=N[i?"getFirst":"getLast"]())&&!(C.is&&C.isBlockBoundary())&&(J=K.root[i?"getPrevious":"getNext"](CKEDITOR.dom.walker.whitespaces(true)))&&!(J.is&&J.isBlockBoundary({br:1}))){L.document.createElement("br")[i?"insertBefore":"insertAfter"](C)}}Q(true);Q();N.replace(K.root)}function s(i,C){this.name=i;this.type=C}var o=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT);function k(G,D,i,C){var F,E;while((F=G[C?"getLast":"getFirst"](o))){if((E=F.getDirection(1))!==D.getDirection(1)){F.setAttribute("dir",E)}F.remove();i?F[C?"insertBefore":"insertAfter"](i):D.append(F,C)}}s.prototype={exec:function(E){var ae=E.document,ab=E.config,ad=E.getSelection(),D=ad&&ad.getRanges(true);if(!D||D.length<1){return}if(this.state==CKEDITOR.TRISTATE_OFF){var O=ae.getBody();if(!O.getFirst(g)){ab.enterMode==CKEDITOR.ENTER_BR?O.appendBogus():D[0].fixBlock(1,ab.enterMode==CKEDITOR.ENTER_P?"p":"div");ad.selectRanges(D)}else{var Q=D.length==1&&D[0],Y=Q&&Q.getEnclosedNode();if(Y&&Y.is&&this.type==Y.getName()){this.setState(CKEDITOR.TRISTATE_ON)}}}var G=ad.createBookmarks(true);var Z=[],P={},N=D.createIterator(),I=0;while((Q=N.getNextRange())&&++I){var X=Q.getBoundaryNodes(),ac=X.startNode,R=X.endNode;if(ac.type==CKEDITOR.NODE_ELEMENT&&ac.getName()=="td"){Q.setStartAt(X.startNode,CKEDITOR.POSITION_AFTER_START)}if(R.type==CKEDITOR.NODE_ELEMENT&&R.getName()=="td"){Q.setEndAt(X.endNode,CKEDITOR.POSITION_BEFORE_END)}var T=Q.createIterator(),M;T.forceBrBreak=(this.state==CKEDITOR.TRISTATE_OFF);while((M=T.getNextParagraph())){if(M.getCustomData("list_block")){continue}else{CKEDITOR.dom.element.setMarker(P,M,"list_block",1)}var S=new CKEDITOR.dom.elementPath(M),aa=S.elements,W=aa.length,F=null,L=0,H=S.blockLimit,C;for(var V=W-1;V>=0&&(C=aa[V]);V--){if(x[C.getName()]&&H.contains(C)){H.removeCustomData("list_group_object_"+I);var K=C.getCustomData("list_group_object");if(K){K.contents.push(M)}else{K={root:C,contents:[M]};Z.push(K);CKEDITOR.dom.element.setMarker(P,C,"list_group_object",K)}L=1;break}}if(L){continue}var U=H;if(U.getCustomData("list_group_object_"+I)){U.getCustomData("list_group_object_"+I).contents.push(M)}else{K={root:U,contents:[M]};CKEDITOR.dom.element.setMarker(P,U,"list_group_object_"+I,K);Z.push(K)}}}var J=[];while(Z.length>0){K=Z.shift();if(this.state==CKEDITOR.TRISTATE_OFF){if(x[K.root.getName()]){j.call(this,E,K,P,J)}else{b.call(this,E,K,J)}}else{if(this.state==CKEDITOR.TRISTATE_ON&&x[K.root.getName()]){z.call(this,E,K,P)}}}for(V=0;V<J.length;V++){B(J[V])}CKEDITOR.dom.element.clearAllMarkers(P);ad.selectBookmarks(G);E.focus()}};function B(C){var i;(i=function(E){var D=C[E?"getPrevious":"getNext"](g);if(D&&D.type==CKEDITOR.NODE_ELEMENT&&D.is(C.getName())){k(C,D,null,!E);C.remove();C=D}})();i(1)}var q=CKEDITOR.dtd;var y=/[\t\r\n ]*(?:&nbsp;|\xa0)$/;function m(E,H){var G,D=E.children,F=D.length;for(var C=0;C<F;C++){G=D[C];if(G.name&&(G.name in H)){return C}}return F}function a(i){return function(H){var E=H.children,G=m(H,q.$list),D=E[G],C=D&&D.previous,I;if(C&&(C.name&&C.name=="br"||C.value&&(I=C.value.match(y)))){var F=C;if(!(I&&I.index)&&F==E[0]){E[0]=(i||CKEDITOR.env.ie)?new CKEDITOR.htmlParser.text("\xa0"):new CKEDITOR.htmlParser.element("br",{})}else{if(F.name=="br"){E.splice(G-1,1)}else{F.value=F.value.replace(y,"")}}}}}var f={elements:{}};for(var u in q.$listItem){f.elements[u]=a()}var v={elements:{}};for(u in q.$listItem){v.elements[u]=a(true)}function r(i){return i.type==CKEDITOR.NODE_ELEMENT&&(i.getName() in CKEDITOR.dtd.$block||i.getName() in CKEDITOR.dtd.$listItem)&&CKEDITOR.dtd[i.getName()]["#"]}function n(G,I,S){G.fire("saveSnapshot");S.enlarge(CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS);var C=S.extractContents();I.trim(false,true);var i=I.createBookmark();var D=new CKEDITOR.dom.elementPath(I.startContainer);var R=D.lastElement.getAscendant("li",1);var K=D.block.getBogus();K&&K.remove();var L=C.getLast();if(L&&L.type==CKEDITOR.NODE_ELEMENT&&L.is("br")){L.remove()}var F=I.startContainer.getChild(I.startOffset);if(F){C.insertBefore(F)}else{I.startContainer.append(C)}var E=new CKEDITOR.dom.elementPath(S.startContainer);var O=S.startContainer.getAscendant("li",1);if(O){var J=t(O);if(J){if(R.contains(O)){k(J,O.getParent(),O);J.remove()}else{R.append(J)}}}while(S.checkStartOfBlock()&&S.checkEndOfBlock()){E=new CKEDITOR.dom.elementPath(S.startContainer);var P=E.block,M;if(P.is("li")){M=P.getParent();if(P.equals(M.getLast(g))&&P.equals(M.getFirst(g))){P=M}}S.moveToPosition(P,CKEDITOR.POSITION_BEFORE_START);P.remove()}var H=S.clone(),N=G.document.getBody();H.setEndAt(N,CKEDITOR.POSITION_BEFORE_END);var T=new CKEDITOR.dom.walker(H);T.evaluator=function(U){return g(U)&&!w(U)};var Q=T.next();if(Q&&Q.type==CKEDITOR.NODE_ELEMENT&&Q.getName() in CKEDITOR.dtd.$list){B(Q)}I.moveToBookmark(i);I.select();G.selectionChange(1);G.fire("saveSnapshot")}function t(i){var C=i.getLast(g);return C&&C.type==CKEDITOR.NODE_ELEMENT&&C.getName() in x?C:null}CKEDITOR.plugins.add("list",{init:function(C){var D=C.addCommand("numberedlist",new s("numberedlist","ol")),i=C.addCommand("bulletedlist",new s("bulletedlist","ul"));C.ui.addButton("NumberedList",{label:C.lang.numberedlist,command:"numberedlist"});C.ui.addButton("BulletedList",{label:C.lang.bulletedlist,command:"bulletedlist"});C.on("selectionChange",CKEDITOR.tools.bind(l,D));C.on("selectionChange",CKEDITOR.tools.bind(l,i));C.on("key",function(S){var R=S.data.keyCode;if(C.mode=="wysiwyg"&&R in {8:1,46:1}){var H=C.getSelection(),K=H.getRanges()[0];if(!K.collapsed){return}var N=R==8;var M=C.document.getBody();var E=new CKEDITOR.dom.walker(K.clone());E.evaluator=function(V){return g(V)&&!w(V)};var T=K.clone();if(N){var L,G;var U=new CKEDITOR.dom.elementPath(K.startContainer);if((L=U.contains(x))&&K.checkBoundaryOfElement(L,CKEDITOR.START)&&(L=L.getParent())&&L.is("li")&&(L=t(L))){G=L;L=L.getPrevious(g);T.moveToPosition(L&&w(L)?L:G,CKEDITOR.POSITION_BEFORE_START)}else{E.range.setStartAt(M,CKEDITOR.POSITION_AFTER_START);E.range.setEnd(K.startContainer,K.startOffset);L=E.previous();if(L&&L.type==CKEDITOR.NODE_ELEMENT&&(L.getName() in x||L.is("li"))){if(!L.is("li")){E.range.selectNodeContents(L);E.reset();E.evaluator=r;L=E.previous()}G=L;T.moveToElementEditEnd(G)}}if(G){n(C,T,K);S.cancel()}}else{var Q=K.startContainer.getAscendant("li",1);if(Q){E.range.setEndAt(M,CKEDITOR.POSITION_BEFORE_END);var P=Q.getLast(g);var I=P&&r(P)?P:Q;var O=0;var J=E.next();if(J&&J.type==CKEDITOR.NODE_ELEMENT&&J.getName() in x&&J.equals(P)){O=1;J=E.next()}else{if(K.checkBoundaryOfElement(I,CKEDITOR.END)){O=1}}if(O&&J){var F=K.clone();F.moveToElementEditStart(J);n(C,T,F);S.cancel()}}}setTimeout(function(){C.selectionChange(1)})}})},afterInit:function(C){var i=C.dataProcessor;if(i){i.dataFilter.addRules(f);i.htmlFilter.addRules(v)}},requires:["domiterator"]})})();