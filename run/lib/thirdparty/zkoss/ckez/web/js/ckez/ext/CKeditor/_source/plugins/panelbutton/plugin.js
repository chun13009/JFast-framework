CKEDITOR.plugins.add("panelbutton",{requires:["button"],onLoad:function(){function a(c){var b=this._;if(b.state==CKEDITOR.TRISTATE_DISABLED){return}this.createPanel(c);if(b.on){b.panel.hide();return}b.panel.showBlock(this._.id,this.document.getById(this._.id),4)}CKEDITOR.ui.panelButton=CKEDITOR.tools.createClass({base:CKEDITOR.ui.button,$:function(b){var c=b.panel;delete b.panel;this.base(b);this.document=(c&&c.parent&&c.parent.getDocument())||CKEDITOR.document;c.block={attributes:c.attributes};this.hasArrow=true;this.click=a;this._={panelDefinition:c}},statics:{handler:{create:function(b){return new CKEDITOR.ui.panelButton(b)}}},proto:{createPanel:function(d){var c=this._;if(c.panel){return}var i=this._.panelDefinition||{},g=this._.panelDefinition.block,f=i.parent||CKEDITOR.document.getBody(),b=this._.panel=new CKEDITOR.ui.floatPanel(d,f,i),h=b.addBlock(c.id,g),e=this;b.onShow=function(){if(e.className){this.element.getFirst().addClass(e.className+"_panel")}e.setState(CKEDITOR.TRISTATE_ON);c.on=1;if(e.onOpen){e.onOpen()}};b.onHide=function(j){if(e.className){this.element.getFirst().removeClass(e.className+"_panel")}e.setState(e.modes&&e.modes[d.mode]?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED);c.on=0;if(!j&&e.onClose){e.onClose()}};b.onEscape=function(){b.hide();e.document.getById(c.id).focus()};if(this.onBlock){this.onBlock(b,h)}h.onHide=function(){c.on=0;e.setState(CKEDITOR.TRISTATE_OFF)}}}})},beforeInit:function(a){a.ui.addHandler(CKEDITOR.UI_PANELBUTTON,CKEDITOR.ui.panelButton.handler)}});CKEDITOR.UI_PANELBUTTON="panelbutton";