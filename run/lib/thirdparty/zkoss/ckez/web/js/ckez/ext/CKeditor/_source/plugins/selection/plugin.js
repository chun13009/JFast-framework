(function(){function g(){try{var p=this.getSelection();if(!p||!p.document.getWindow().$){return}var n=p.getStartElement();var o=new CKEDITOR.dom.elementPath(n);if(!o.compare(this._.selectionPreviousPath)){this._.selectionPreviousPath=o;this.fire("selectionChange",{selection:p,path:o,element:n})}}catch(q){}}var c,d;function l(){d=true;if(c){return}e.call(this);c=CKEDITOR.tools.setTimeout(e,200,this)}function e(){c=null;if(d){CKEDITOR.tools.setTimeout(g,0,this);d=false}}function f(n){function q(s){return s&&s.type==CKEDITOR.NODE_ELEMENT&&s.getName() in CKEDITOR.dtd.$removeEmpty}function o(t){var s=n.document.getBody();return !t.is("body")&&s.getChildCount()==1}var r=n.startContainer,p=n.startOffset;if(r.type==CKEDITOR.NODE_TEXT){return false}return !CKEDITOR.tools.trim(r.getHtml())?q(r)||o(r):q(r.getChild(p-1))||q(r.getChild(p))}var b={modes:{wysiwyg:1,source:1},readOnly:CKEDITOR.env.ie||CKEDITOR.env.webkit,exec:function(o){switch(o.mode){case"wysiwyg":o.document.$.execCommand("SelectAll",false,null);o.forceNextSelectionCheck();o.selectionChange();break;case"source":var n=o.textarea.$;if(CKEDITOR.env.ie){n.createTextRange().execCommand("SelectAll")}else{n.selectionStart=0;n.selectionEnd=n.value.length}n.focus()}},canUndo:false};function m(o){i(o);var n=o.createText("\u200B");o.setCustomData("cke-fillingChar",n);return n}function a(n){return n&&n.getCustomData("cke-fillingChar")}function j(o){var n=o&&a(o);if(n){if(n.getCustomData("ready")){i(o)}else{n.setCustomData("ready",1)}}}function i(t){var s=t&&t.removeCustomData("cke-fillingChar");if(s){var u,r=t.getSelection().getNative(),o=r&&r.type!="None"&&r.getRangeAt(0);if(s.getLength()>1&&o&&o.intersectsNode(s.$)){u=[r.anchorOffset,r.focusOffset];var p=r.anchorNode==s.$&&r.anchorOffset>0,q=r.focusNode==s.$&&r.focusOffset>0;p&&u[0]--;q&&u[1]--;k(r)&&u.unshift(u.pop())}s.setText(s.getText().replace(/\u200B/g,""));if(u){var n=r.getRangeAt(0);n.setStart(n.startContainer,u[0]);n.setEnd(n.startContainer,u[1]);r.removeAllRanges();r.addRange(n)}}}function k(o){if(!o.isCollapsed){var n=o.getRangeAt(0);n.setStart(o.anchorNode,o.anchorOffset);n.setEnd(o.focusNode,o.focusOffset);return n.collapsed}}CKEDITOR.plugins.add("selection",{init:function(p){if(CKEDITOR.env.webkit){p.on("selectionChange",function(){j(p.document)});p.on("beforeSetMode",function(){i(p.document)});var n,q;function o(){var u=p.document,t=a(u);if(t){var s=u.$.defaultView.getSelection();if(s.type=="Caret"&&s.anchorNode==t.$){q=1}n=t.getText();t.setText(n.replace(/\u200B/g,""))}}function r(){var t=p.document,s=a(t);if(s){s.setText(n);if(q){t.$.defaultView.getSelection().setPosition(s.$,s.getLength());q=0}}}p.on("beforeUndoImage",o);p.on("afterUndoImage",r);p.on("beforeGetData",o,null,null,0);p.on("getData",r)}p.on("contentDom",function(){var z=p.document,v=z.getBody(),u=z.getDocumentElement();if(CKEDITOR.env.ie){var w,A,t=1;v.on("focusin",function(D){if(D.data.$.srcElement.nodeName!="BODY"){return}var C=z.getCustomData("cke_locked_selection");if(C){C.unlock(1);C.lock()}else{if(w&&t){try{w.select()}catch(E){}w=null}}});v.on("focus",function(){A=1;s()});v.on("beforedeactivate",function(C){if(C.data.$.toElement){return}A=0;t=1});CKEDITOR.env.ie&&p.on("blur",function(){try{z.$.selection.empty()}catch(C){}});u.on("mousedown",function(){t=0});u.on("mouseup",function(){t=1});var y;v.on("mousedown",function(C){if(C.data.$.button==2){var D=p.document.$.selection;if(D.type=="None"){y=p.window.getScrollPosition()}}x()});v.on("mouseup",function(C){if(C.data.$.button==2&&y){p.document.$.documentElement.scrollLeft=y.x;p.document.$.documentElement.scrollTop=y.y}y=null;A=1;setTimeout(function(){s(true)},0)});v.on("keydown",x);v.on("keyup",function(){A=1;s()});if((CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat)&&z.$.compatMode!="BackCompat"){function B(D,C,F){try{D.moveToPoint(C,F)}catch(E){}}u.on("mousedown",function(C){function E(F){F=F.data.$;if(D){var G=v.$.createTextRange();B(G,F.x,F.y);D.setEndPoint(D.compareEndPoints("StartToStart",G)<0?"EndToEnd":"StartToStart",G);D.select()}}C=C.data.$;if(C.y<u.$.clientHeight&&C.y>v.$.offsetTop+v.$.clientHeight&&C.x<u.$.clientWidth){var D=v.$.createTextRange();B(D,C.x,C.y);u.on("mousemove",E);u.on("mouseup",function(F){u.removeListener("mousemove",E);F.removeListener();D.select()})}})}if(CKEDITOR.env.ie8){u.on("mouseup",function(C){if(C.data.getTarget().getName()=="html"){var E=CKEDITOR.document.$.selection,D=E.createRange();if(E.type!="None"&&D.parentElement().ownerDocument==z.$){D.select()}}})}z.on("selectionchange",s);function x(){A=0}function s(F){if(A){var E=p.document,D=p.getSelection(),C=D&&D.getNative();if(F&&C&&C.type=="None"){if(!E.$.queryCommandEnabled("InsertImage")){CKEDITOR.tools.setTimeout(s,50,this,true);return}}var G;if(C&&C.type&&C.type!="Control"&&(G=C.createRange())&&(G=G.parentElement())&&(G=G.nodeName)&&G.toLowerCase() in {input:1,textarea:1}){return}w=C&&D.getRanges()[0];l.call(p)}}}else{z.on("mouseup",l,p);z.on("keyup",l,p);z.on("selectionchange",l,p)}if(CKEDITOR.env.webkit){z.on("keydown",function(C){var D=C.data.getKey();switch(D){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:i(p.document)}},null,null,10)}});p.on("contentDomUnload",p.forceNextSelectionCheck,p);p.addCommand("selectAll",b);p.ui.addButton("SelectAll",{label:p.lang.selectAll,command:"selectAll"});p.selectionChange=function(s){(s?g:l).call(this)};CKEDITOR.env.ie9Compat&&p.on("destroy",function(){var s=p.getSelection();s&&s.getNative().clear()},null,null,9)}});CKEDITOR.editor.prototype.getSelection=function(){return this.document&&this.document.getSelection()};CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath};CKEDITOR.dom.document.prototype.getSelection=function(){var n=new CKEDITOR.dom.selection(this);return(!n||n.isInvalid)?null:n};CKEDITOR.SELECTION_NONE=1;CKEDITOR.SELECTION_TEXT=2;CKEDITOR.SELECTION_ELEMENT=3;CKEDITOR.dom.selection=function(o){var n=o.getCustomData("cke_locked_selection");if(n){return n}this.document=o;this.isLocked=0;this._={cache:{}};if(CKEDITOR.env.ie){try{var p=this.getNative().createRange();if(!p||(p.item&&p.item(0).ownerDocument!=this.document.$)||(p.parentElement&&p.parentElement().ownerDocument!=this.document.$)){throw 0}}catch(q){this.isInvalid=true}}return this};var h={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.dom.selection.prototype={getNative:CKEDITOR.env.ie?function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.$.selection)}:function(){return this._.cache.nativeSel||(this._.cache.nativeSel=this.document.getWindow().$.getSelection())},getType:CKEDITOR.env.ie?function(){var n=this._.cache;if(n.type){return n.type}var o=CKEDITOR.SELECTION_NONE;try{var p=this.getNative(),r=p.type;if(r=="Text"){o=CKEDITOR.SELECTION_TEXT}if(r=="Control"){o=CKEDITOR.SELECTION_ELEMENT}if(p.createRange().parentElement){o=CKEDITOR.SELECTION_TEXT}}catch(q){}return(n.type=o)}:function(){var o=this._.cache;if(o.type){return o.type}var p=CKEDITOR.SELECTION_TEXT;var r=this.getNative();if(!r){p=CKEDITOR.SELECTION_NONE}else{if(r.rangeCount==1){var n=r.getRangeAt(0),q=n.startContainer;if(q==n.endContainer&&q.nodeType==1&&(n.endOffset-n.startOffset)==1&&h[q.childNodes[n.startOffset].nodeName.toLowerCase()]){p=CKEDITOR.SELECTION_ELEMENT}}}return(o.type=p)},getRanges:(function(){var n=CKEDITOR.env.ie?(function(){function o(q){return new CKEDITOR.dom.node(q).getIndex()}var p=function(z,s){z=z.duplicate();z.collapse(s);var E=z.parentElement(),D=E.ownerDocument;if(!E.hasChildNodes()){return{container:E,offset:0}}var C=E.children,u,G,v=z.duplicate(),F=0,y=C.length-1,A=-1,x,r,q;while(F<=y){A=Math.floor((F+y)/2);u=C[A];v.moveToElementText(u);x=v.compareEndPoints("StartToStart",z);if(x>0){y=A-1}else{if(x<0){F=A+1}else{if(CKEDITOR.env.ie9Compat&&u.tagName=="BR"){var t=D.defaultView.getSelection();return{container:t[s?"anchorNode":"focusNode"],offset:t[s?"anchorOffset":"focusOffset"]}}else{return{container:E,offset:o(u)}}}}}if(A==-1||A==C.length-1&&x<0){v.moveToElementText(E);v.setEndPoint("StartToStart",z);r=v.text.replace(/(\r\n|\r)/g,"\n").length;C=E.childNodes;if(!r){u=C[C.length-1];if(u.nodeType!=CKEDITOR.NODE_TEXT){return{container:E,offset:C.length}}else{return{container:u,offset:u.nodeValue.length}}}var w=C.length;while(r>0&&w>0){G=C[--w];if(G.nodeType==CKEDITOR.NODE_TEXT){q=G;r-=G.nodeValue.length}}return{container:q,offset:-r}}else{v.collapse(x>0?true:false);v.setEndPoint(x>0?"StartToStart":"EndToStart",z);r=v.text.replace(/(\r\n|\r)/g,"\n").length;if(!r){return{container:E,offset:o(u)+(x>0?0:1)}}while(r>0){try{G=u[x>0?"previousSibling":"nextSibling"];if(G.nodeType==CKEDITOR.NODE_TEXT){r-=G.nodeValue.length;q=G}u=G}catch(B){return{container:E,offset:o(u)}}}return{container:q,offset:x>0?-r:q.nodeValue.length+r}}};return function(){var s=this.getNative(),x=s&&s.createRange(),y=this.getType(),w;if(!s){return[]}if(y==CKEDITOR.SELECTION_TEXT){w=new CKEDITOR.dom.range(this.document);var q=p(x,true);w.setStart(new CKEDITOR.dom.node(q.container),q.offset);q=p(x);w.setEnd(new CKEDITOR.dom.node(q.container),q.offset);if(w.endContainer.getPosition(w.startContainer)&CKEDITOR.POSITION_PRECEDING&&w.endOffset<=w.startContainer.getIndex()){w.collapse()}return[w]}else{if(y==CKEDITOR.SELECTION_ELEMENT){var r=[];for(var u=0;u<x.length;u++){var v=x.item(u),z=v.parentNode,t=0;w=new CKEDITOR.dom.range(this.document);for(;t<z.childNodes.length&&z.childNodes[t]!=v;t++){}w.setStart(new CKEDITOR.dom.node(z),t);w.setEnd(new CKEDITOR.dom.node(z),t+1);r.push(w)}return r}}return[]}})():function(){var o=[],p,t=this.document,s=this.getNative();if(!s){return o}if(!s.rangeCount){p=new CKEDITOR.dom.range(t);p.moveToElementEditStart(t.getBody());o.push(p)}for(var q=0;q<s.rangeCount;q++){var r=s.getRangeAt(q);p=new CKEDITOR.dom.range(t);p.setStart(new CKEDITOR.dom.node(r.startContainer),r.startOffset);p.setEnd(new CKEDITOR.dom.node(r.endContainer),r.endOffset);o.push(p)}return o};return function(z){var p=this._.cache;if(p.ranges&&!z){return p.ranges}else{if(!p.ranges){p.ranges=new CKEDITOR.dom.rangeList(n.call(this))}}if(z){var q=p.ranges;for(var t=0;t<q.length;t++){var u=q[t];var y=u.getCommonAncestor();if(y.isReadOnly()){q.splice(t,1)}if(u.collapsed){continue}if(u.startContainer.isReadOnly()){var v=u.startContainer;while(v){if(v.is("body")||!v.isReadOnly()){break}if(v.type==CKEDITOR.NODE_ELEMENT&&v.getAttribute("contentEditable")=="false"){u.setStartAfter(v)}v=v.getParent()}}var s=u.startContainer,A=u.endContainer,w=u.startOffset,x=u.endOffset,r=u.clone();if(s&&s.type==CKEDITOR.NODE_TEXT){if(w>=s.getLength()){r.setStartAfter(s)}else{r.setStartBefore(s)}}if(A&&A.type==CKEDITOR.NODE_TEXT){if(!x){r.setEndBefore(A)}else{r.setEndAfter(A)}}var o=new CKEDITOR.dom.walker(r);o.evaluator=function(C){if(C.type==CKEDITOR.NODE_ELEMENT&&C.isReadOnly()){var B=u.clone();u.setEndBefore(C);if(u.collapsed){q.splice(t--,1)}if(!(C.getPosition(r.endContainer)&CKEDITOR.POSITION_CONTAINS)){B.setStartAfter(C);if(!B.collapsed){q.splice(t+1,0,B)}}return true}return false};o.next()}}return p.ranges}})(),getStartElement:function(){var p=this._.cache;if(p.startElement!==undefined){return p.startElement}var r,s=this.getNative();switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var o=this.getRanges()[0];if(o){if(!o.collapsed){o.optimize();while(1){var q=o.startContainer,n=o.startOffset;if(n==(q.getChildCount?q.getChildCount():q.getLength())&&!q.isBlockBoundary()){o.setStartAfter(q)}else{break}}r=o.startContainer;if(r.type!=CKEDITOR.NODE_ELEMENT){return r.getParent()}r=r.getChild(o.startOffset);if(!r||r.type!=CKEDITOR.NODE_ELEMENT){r=o.startContainer}else{var t=r.getFirst();while(t&&t.type==CKEDITOR.NODE_ELEMENT){r=t;t=t.getFirst()}}}else{r=o.startContainer;if(r.type!=CKEDITOR.NODE_ELEMENT){r=r.getParent()}}r=r.$}}return p.startElement=(r?new CKEDITOR.dom.element(r):null)},getSelectedElement:function(){var o=this._.cache;if(o.selectedElement!==undefined){return o.selectedElement}var n=this;var p=CKEDITOR.tools.tryThese(function(){return n.getNative().createRange().item(0)},function(){var y,r,v=n.getRanges()[0],u=v.getCommonAncestor(1,1),A={table:1,ul:1,ol:1,dl:1};for(var z in A){if((y=u.getAscendant(z,1))){break}}if(y){var s=new CKEDITOR.dom.range(this.document);s.setStartAt(y,CKEDITOR.POSITION_AFTER_START);s.setEnd(v.startContainer,v.startOffset);var w=CKEDITOR.tools.extend(A,CKEDITOR.dtd.$listItem,CKEDITOR.dtd.$tableContent),q=new CKEDITOR.dom.walker(s),x=function(B,t){return function(D,E){if(D.type==CKEDITOR.NODE_TEXT&&(!CKEDITOR.tools.trim(D.getText())||D.getParent().data("cke-bookmark"))){return true}var C;if(D.type==CKEDITOR.NODE_ELEMENT){C=D.getName();if(C=="br"&&t&&D.equals(D.getParent().getBogus())){return true}if(E&&C in w||C in CKEDITOR.dtd.$removeEmpty){return true}}B.halted=1;return false}};q.guard=x(q);if(q.checkBackward()&&!q.halted){q=new CKEDITOR.dom.walker(s);s.setStart(v.endContainer,v.endOffset);s.setEndAt(y,CKEDITOR.POSITION_BEFORE_END);q.guard=x(q,1);if(q.checkForward()&&!q.halted){r=y.$}}}if(!r){throw 0}return r},function(){var q=n.getRanges()[0],t,s;for(var r=2;r&&!((t=q.getEnclosedNode())&&(t.type==CKEDITOR.NODE_ELEMENT)&&h[t.getName()]&&(s=t));r--){q.shrink(CKEDITOR.SHRINK_ELEMENT)}return s.$});return o.selectedElement=(p?new CKEDITOR.dom.element(p):null)},getSelectedText:function(){var n=this._.cache;if(n.selectedText!==undefined){return n.selectedText}var p="",o=this.getNative();if(this.getType()==CKEDITOR.SELECTION_TEXT){p=CKEDITOR.env.ie?o.createRange().text:o.toString()}return(n.selectedText=p)},lock:function(){this.getRanges();this.getStartElement();this.getSelectedElement();this.getSelectedText();this._.cache.nativeSel={};this.isLocked=1;this.document.setCustomData("cke_locked_selection",this)},unlock:function(p){var q=this.document,n=q.getCustomData("cke_locked_selection");if(n){q.setCustomData("cke_locked_selection",null);if(p){var r=n.getSelectedElement(),o=!r&&n.getRanges();this.isLocked=0;this.reset();if(r){this.selectElement(r)}else{this.selectRanges(o)}}}if(!n||!p){this.isLocked=0;this.reset()}},reset:function(){this._.cache={}},selectElement:function(o){if(this.isLocked){var n=new CKEDITOR.dom.range(this.document);n.setStartBefore(o);n.setEndAfter(o);this._.cache.selectedElement=o;this._.cache.startElement=o;this._.cache.ranges=new CKEDITOR.dom.rangeList(n);this._.cache.type=CKEDITOR.SELECTION_ELEMENT;return}n=new CKEDITOR.dom.range(o.getDocument());n.setStartBefore(o);n.setEndAfter(o);n.select();this.document.fire("selectionchange");this.reset()},selectRanges:function(n){if(this.isLocked){this._.cache.selectedElement=null;this._.cache.startElement=n[0]&&n[0].getTouchedStartNode();this._.cache.ranges=new CKEDITOR.dom.rangeList(n);this._.cache.type=CKEDITOR.SELECTION_TEXT;return}if(CKEDITOR.env.ie){if(n.length>1){var x=n[n.length-1];n[0].setEnd(x.endContainer,x.endOffset);n.length=1}if(n[0]){n[0].select()}this.reset()}else{var o=this.getNative();if(!o){return}if(n.length){o.removeAllRanges();CKEDITOR.env.webkit&&i(this.document)}for(var r=0;r<n.length;r++){if(r<n.length-1){var q=n[r],y=n[r+1],A=q.clone();A.setStart(q.endContainer,q.endOffset);A.setEnd(y.startContainer,y.startOffset);if(!A.collapsed){A.shrink(CKEDITOR.NODE_ELEMENT,true);var u=A.getCommonAncestor(),B=A.getEnclosedNode();if(u.isReadOnly()||B&&B.isReadOnly()){y.setStart(q.startContainer,q.startOffset);n.splice(r--,1);continue}}}var t=n[r];var v=this.document.$.createRange();var p=t.startContainer;if(t.collapsed&&(CKEDITOR.env.opera||(CKEDITOR.env.gecko&&CKEDITOR.env.version<10900))&&p.type==CKEDITOR.NODE_ELEMENT&&!p.getChildCount()){p.appendText("")}if(t.collapsed&&CKEDITOR.env.webkit&&f(t)){var z=m(this.document);t.insertNode(z);var s=z.getNext();if(s&&!z.getPrevious()&&s.type==CKEDITOR.NODE_ELEMENT&&s.getName()=="br"){i(this.document);t.moveToPosition(s,CKEDITOR.POSITION_BEFORE_START)}else{t.moveToPosition(z,CKEDITOR.POSITION_AFTER_END)}}v.setStart(t.startContainer.$,t.startOffset);try{v.setEnd(t.endContainer.$,t.endOffset)}catch(w){if(w.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0){t.collapse(1);v.setEnd(t.endContainer.$,t.endOffset)}else{throw w}}o.addRange(v)}this.document.fire("selectionchange");this.reset()}},createBookmarks:function(n){return this.getRanges().createBookmarks(n)},createBookmarks2:function(n){return this.getRanges().createBookmarks2(n)},selectBookmarks:function(q){var n=[];for(var p=0;p<q.length;p++){var o=new CKEDITOR.dom.range(this.document);o.moveToBookmark(q[p]);n.push(o)}this.selectRanges(n);return this},getCommonAncestor:function(){var o=this.getRanges(),p=o[0].startContainer,n=o[o.length-1].endContainer;return p.getCommonAncestor(n)},scrollIntoView:function(){var n=this.getStartElement();n.scrollIntoView()}}})();(function(){var a=CKEDITOR.dom.walker.whitespaces(true),b=/\ufeff|\u00a0/,c={table:1,tbody:1,tr:1};CKEDITOR.dom.range.prototype.select=CKEDITOR.env.ie?function(f){var g=this.collapsed,n,k,d;var h=this.getEnclosedNode();if(h){try{d=this.document.$.body.createControlRange();d.addElement(h.$);d.select();return}catch(o){}}if(this.startContainer.type==CKEDITOR.NODE_ELEMENT&&this.startContainer.getName() in c||this.endContainer.type==CKEDITOR.NODE_ELEMENT&&this.endContainer.getName() in c){this.shrink(CKEDITOR.NODE_ELEMENT,true)}var m=this.createBookmark();var e=m.startNode;var j;if(!g){j=m.endNode}d=this.document.$.body.createTextRange();d.moveToElementText(e.$);d.moveStart("character",1);if(j){var l=this.document.$.body.createTextRange();l.moveToElementText(j.$);d.setEndPoint("EndToEnd",l);d.moveEnd("character",-1)}else{var i=e.getNext(a);n=(!(i&&i.getText&&i.getText().match(b))&&(f||!e.hasPrevious()||(e.getPrevious().is&&e.getPrevious().is("br"))));k=this.document.createElement("span");k.setHtml("&#65279;");k.insertBefore(e);if(n){this.document.createText("\ufeff").insertBefore(e)}}this.setStartBefore(e);e.remove();if(g){if(n){d.moveStart("character",-1);d.select();this.document.$.selection.clear()}else{d.select()}this.moveToPosition(k,CKEDITOR.POSITION_BEFORE_START);k.remove()}else{this.setEndBefore(j);j.remove();d.select()}this.document.fire("selectionchange")}:function(){this.document.getSelection().selectRanges([this])}})();