(function(){function d(f,e){e=e===undefined||e;var h;if(e){h=f.getComputedStyle("text-align")}else{while(!f.hasAttribute||!(f.hasAttribute("align")||f.getStyle("text-align"))){var g=f.getParent();if(!g){break}f=g}h=f.getStyle("text-align")||f.getAttribute("align")||""}h&&(h=h.replace(/(?:-(?:moz|webkit)-)?(?:start|auto)/i,""));!h&&e&&(h=f.getComputedStyle("direction")=="rtl"?"right":"left");return h}function c(e){if(e.editor.readOnly){return}e.editor.getCommand(this.name).refresh(e.data.path)}function b(g,e,h){this.editor=g;this.name=e;this.value=h;var f=g.config.justifyClasses;if(f){switch(h){case"left":this.cssClassName=f[0];break;case"center":this.cssClassName=f[1];break;case"right":this.cssClassName=f[2];break;case"justify":this.cssClassName=f[3];break}this.cssClassRegex=new RegExp("(?:^|\\s+)(?:"+f.join("|")+")(?=$|\\s)")}}function a(k){var i=k.editor;var f=new CKEDITOR.dom.range(i.document);f.setStartBefore(k.data.node);f.setEndAfter(k.data.node);var l=new CKEDITOR.dom.walker(f),j;while((j=l.next())){if(j.type==CKEDITOR.NODE_ELEMENT){if(!j.equals(k.data.node)&&j.getDirection()){f.setStartAfter(j);l=new CKEDITOR.dom.walker(f);continue}var g=i.config.justifyClasses;if(g){if(j.hasClass(g[0])){j.removeClass(g[0]);j.addClass(g[2])}else{if(j.hasClass(g[2])){j.removeClass(g[2]);j.addClass(g[0])}}}var h="text-align";var m=j.getStyle(h);if(m=="left"){j.setStyle(h,"right")}else{if(m=="right"){j.setStyle(h,"left")}}}}}b.prototype={exec:function(l){var o=l.getSelection(),n=l.config.enterMode;if(!o){return}var f=o.createBookmarks(),e=o.getRanges(true);var p=this.cssClassName,k,h;var g=l.config.useComputedState;g=g===undefined||g;for(var j=e.length-1;j>=0;j--){k=e[j].createIterator();k.enlargeBr=n!=CKEDITOR.ENTER_BR;while((h=k.getNextParagraph(n==CKEDITOR.ENTER_P?"p":"div"))){h.removeAttribute("align");h.removeStyle("text-align");var m=p&&(h.$.className=CKEDITOR.tools.ltrim(h.$.className.replace(this.cssClassRegex,"")));var q=(this.state==CKEDITOR.TRISTATE_OFF)&&(!g||(d(h,true)!=this.value));if(p){if(q){h.addClass(p)}else{if(!m){h.removeAttribute("class")}}}else{if(q){h.setStyle("text-align",this.value)}}}}l.focus();l.forceNextSelectionCheck();o.selectBookmarks(f)},refresh:function(f){var e=f.block||f.blockLimit;this.setState(e.getName()!="body"&&d(e,this.editor.config.useComputedState)==this.value?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF)}};CKEDITOR.plugins.add("justify",{init:function(h){var i=new b(h,"justifyleft","left"),e=new b(h,"justifycenter","center"),g=new b(h,"justifyright","right"),f=new b(h,"justifyblock","justify");h.addCommand("justifyleft",i);h.addCommand("justifycenter",e);h.addCommand("justifyright",g);h.addCommand("justifyblock",f);h.ui.addButton("JustifyLeft",{label:h.lang.justify.left,command:"justifyleft"});h.ui.addButton("JustifyCenter",{label:h.lang.justify.center,command:"justifycenter"});h.ui.addButton("JustifyRight",{label:h.lang.justify.right,command:"justifyright"});h.ui.addButton("JustifyBlock",{label:h.lang.justify.block,command:"justifyblock"});h.on("selectionChange",CKEDITOR.tools.bind(c,i));h.on("selectionChange",CKEDITOR.tools.bind(c,g));h.on("selectionChange",CKEDITOR.tools.bind(c,e));h.on("selectionChange",CKEDITOR.tools.bind(c,f));h.on("dirChanged",a)},requires:["domiterator"]})})();