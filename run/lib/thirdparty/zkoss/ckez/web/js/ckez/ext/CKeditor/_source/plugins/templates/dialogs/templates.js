(function(){var a=CKEDITOR.document;CKEDITOR.dialog.add("templates",function(i){function g(k,q){k.setHtml("");for(var p=0,m=q.length;p<m;p++){var n=CKEDITOR.getTemplates(q[p]),l=n.imagesPath,s=n.templates,r=s.length;for(var o=0;o<r;o++){var t=s[o],u=f(t,l);u.setAttribute("aria-posinset",o+1);u.setAttribute("aria-setsize",r);k.append(u)}}}function f(m,l){var n=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>');var k='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';if(m.image&&l){k+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(l+m.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>'}k+='<td style="white-space:normal;"><span class="cke_tpl_title">'+m.title+"</span><br/>";if(m.description){k+="<span>"+m.description+"</span>"}k+="</td></tr></table>";n.getFirst().setHtml(k);n.on("click",function(){h(m.html)});return n}function h(m){var l=CKEDITOR.dialog.getCurrent(),k=l.getValueOf("selectTpl","chkInsertOpt");if(k){i.on("contentDom",function(n){n.removeListener();l.hide();var o=new CKEDITOR.dom.range(i.document);o.moveToElementEditStart(i.document.getBody());o.select(1);setTimeout(function(){i.fire("saveSnapshot")},0)});i.fire("saveSnapshot");i.setData(m)}else{i.insertHtml(m);l.hide()}}function b(k){var o=k.data.getTarget(),m=j.equals(o);if(m||j.contains(o)){var n=k.data.getKeystroke(),l=j.getElementsByTag("a"),p;if(l){if(m){p=l.getItem(0)}else{switch(n){case 40:p=o.getNext();break;case 38:p=o.getPrevious();break;case 13:case 32:o.fire("click")}}if(p){p.focus();k.data.preventDefault()}}}}CKEDITOR.skins.load(i,"templates");var j;var c="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),d=i.lang.templates,e=i.config;return{title:i.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:d.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+d.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:true,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+c+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+c+'">'+d.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:d.insertOption,"default":e.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var k=this.getContentElement("selectTpl","templatesList");j=k.getElement();CKEDITOR.loadTemplates(e.templates_files,function(){var l=(e.templates||"default").split(",");if(l.length){g(j,l);k.focus()}else{j.setHtml('<div class="cke_tpl_empty"><span>'+d.emptyListMsg+"</span></div>")}});this._.element.on("keydown",b)},onHide:function(){this._.element.removeListener("keydown",b)}}})})();